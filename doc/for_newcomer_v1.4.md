# 課題アプリケーションの要件

## 課題アプリケーション : タスク管理システム

## この研修プログラムについて:

本研修は、万葉で必須とされる Ruby on Rails とその周辺技術の基礎を習得するためのプログラムです。新入社員の能力に依らず、必ず一通りのステップを実施していただきます。

研修期間は特に定めておりません。すべてのステップを完了（＋オプションの要件）した時点で研修修了となります。

※ 期間ついては、社内の案件状況などに応じて、メンターの方で予め目安を設定する予定ですので、それに従って下さい。

## 概要:

### システムの要件

タスク管理システムでは、以下のことを行いたいと考えています。

- 自分のタスクを簡単に登録したい

- タスクに終了期限を設定できるようにしたい

- タスクに優先順位をつけたい

- ステータス（未着手、着手、完了）を管理したい

- ステータスでタスクを絞り込みたい

- タスク名・タスクの説明文でタスクを検索したい

- タスクを一覧したい。一覧画面で（優先順位、終了期限などを元にして）ソートしたい

- タスクにラベルなどをつけて分類したい

- ユーザ登録して使いたい

  - ログインして自分が登録したタスクだけを見られるようにしたい

上記の要件を満たすにあたって、次のような管理機能が欲しいと考えています。

- ユーザの管理機能

サポートブラウザについて

- サポートブラウザは Chrome を想定しています

### アプリケーション（サーバ）の構成について

以下の言語・ミドルウェアを使って構築して頂きたいです（いずれも最新の安定バージョンで）

- Ruby / Rails

- PostgreSQL

サーバについては以下を利用していただきたいです

- Heroku （万葉のアカウントを利用）

- 【オプション要件】万葉のAWSアカウントで、EC2のインスタンスを作成して構築する

  - t2.micro (Amazon linux)

  - RDS

※ 性能要求・セキュリティ要求は特に定めませんが、一般的な品質で作ってください。

あまりにサイトのレスポンスが悪い場合は改善をしていただきます。

## 本カリキュラムの最終目標

本カリキュラムの終了時点で、以下の様なことが習得できているはずです

- Railsを利用した基本的なWebアプリケーションのコーディングができるようになること

- Railsアプリケーションで一般的な環境を使ってアプリケーションを公開できること

- 公開されたRailsアプリケーションに対して、機能の追加やデータのメンテナンスができること

- GitHubでPRをしてマージする一連の流れを習得すること、また、それに必要なgitのコマンドを習得すること

  - 適切な粒度でコミットができること

  - 適切にPRの説明文が書けること

  - レビューに対する対応と修正が一通りできること

- 不明な点を適切なタイミングでチームメンバーや関係者に（今回はメンターになります）口頭やチャットなどで質問ができること

## 課題ステップ

### ステップ1: Railsの開発環境を構築しよう

#### 1-1: Rubyのインストール

- [rbenv](https://github.com/rbenv/rbenv) を利用して最新バージョンのRubyをインストールしてください

- ruby -v コマンドでRubyのバージョンが表示されることを確認してください

#### 1-2: Railsのインストール

- GemコマンドでRailsをインストールしましょう

- 最新バージョンのRailsをインストールして下さい

- rails -v コマンドでRailsのバージョンが表示されることを確認してください

#### 1-3: Database(PostgreSQL)のインストール

- 手元のOSで PostgreSQL をインストールしましょう

  - MacOSの場合は brew などでインストールしてください

### ステップ2: Githubにリポジトリを作成しよう

- 手元にGitをインストールしましょう

  - MacOSの場合は brew などでインストールして下さい

  - gitconfigでユーザ名、メールアドレスを登録しましょう

- アプリ名（= リポジトリ名）を考えましょう

- 万葉のプライベートスペースにリポジトリを作成しよう

  - アカウントがない場合は取得します

  - （もし未だjoinしていなかったら）自分のアカウントを万葉のorganizationにjoinしてもらいましょう

  - その上で空のリポジトリを作成します

### ステップ3: Railsプロジェクトを作成しよう

- rails new コマンドでアプリケーションに最低限必要なフォルダやファイルを作成しましょう

- Rails new してできたプロジェクトのフォルダ (アプリ名のフォルダ）の直下に docs というフォルダを作り、この文書ファイルをコミットしましょう

  - このアプリの仕様を管理下に置いていつでも見られるようにするためです

- 作成したアプリをGitHub上に作成したリポジトリにpushしましょう

- バージョンを明示するため、利用する ruby のバージョンをGemfileに記載しましょう（railsは既にバージョンが記載されていることを確認しましょう）

### ステップ4: 作りたいアプリケーションのイメージを考える

- 設計を進める前にどのようなアプリになるか完成イメージを(メンターと一緒に)考えてみましょう。ペーパープロトタイピングなどの画面設計などがおすすめです。

- システムの要件を読んで、必要なデータ構造を考えてみましょう。

  - どのようなモデル（テーブル）が必要そうか

  - テーブル内にどのような情報が必要そうか

- データ構造を考えたら、それをモデル図に手書きで書いてみましょう

  - 完成したら撮影して、リポジトリに入れましょう

  - README.md にテーブルスキーマを記載しましょう（モデル名、カラム名、データ型）

- ※ 現時点で正解のモデル図を作成する必要はまだありません。現時点での想定として作ってみましょう。（今後のステップで間違いと思ったら改修していくイメージで良いと思います。）

### ステップ5: データベースの接続設定（周辺設定）をしましょう

- まずgitで新たにtopicブランチを切りましょう

  - 以降、topicブランチ上で作業をしてコミットをしていきます

- bundler をインストールしましょう

- Gemfileで pg （PostgreSQLのデータベースドライバ）をインストールしましょう

- database.yml の設定をしましょう

- $ rails db:create コマンドでデータベースの作成をしましょう

- $ rails db コマンドでデータベースへの接続確認をしましょう

- GitHub上でPRを作成してレビューしてもらいましょう

  - コメントが付いたらその対応を行ってLGTM（Look Good To Me）が2つついたらmasterブランチにマージしましょう

### ステップ6: タスクモデルを作成しましょう

タスクを管理するためのCRUDを作成します。まずは名前と詳細だけが登録できるシンプルな構成で作りましょう

- rails generate コマンドでタスクのCRUDに必要なモデルクラスを作成しましょう

- migration を作成してテーブルを作成しましょう

  - Migrationは１つ前の状態に戻せることを担保できていることが大切です！redoを流して確認する癖をつけましょう

- $ rails c コマンドでモデル経由でデータベースに接続できることを確認しましょう

  - この時に試しに ActiveRecord でレコードを作成してみる

- GitHub上でPRを作成してレビューしてもらいましょう

### ステップ7: タスクを登録・更新・削除できるようにしよう

- タスクの一覧画面、作成画面、詳細画面、編集画面を作成しましょう

  - Rails generate コマンドで controller と view を作成します

  - Controller と view に必要な実装を追加しましょう

  - 作成、更新、削除後はそれぞれflashメッセージを画面に表示させましょう

- routes.rb を編集して、 http://localhost:3000/  でタスクの一覧画面が表示されるようにしましょう。

- GitHub上でPRを作成してレビューしてもらいましょう

  - 今後、PRが大きくなりそうだったらPRを２回以上に分けることを検討しましょう

### ステップ8: テスト(feature spec)を書こう

- Specを書くための準備をしましょう

  - spec/spec_helper.rb, spec/rails_helper.rb を用意しましょう

- feature spec をタスク機能に対して書きましょう

- Circle CI などの CIツール を導入して、slackに通知するようにしましょう

  - オプションですが、メンターが利便性のために追加しても可です

- 参考書籍：https://leanpub.com/everydayrailsrspec-jp

  - 購入申請不要です。購入後精算するようにしてください。

### ステップ9: Rails の i18n を使ってアプリの日本語部分を共通化しましょう

-  Rails の i18n の仕組みを利用して、日本語リソースの共通化をしましょう

  - ※ i18n 化を行うと後のステップでメッセージを出したりするのが楽になったりします

### ステップ10: Railsのタイムゾーンを設定しましょう

- Railsのタイムゾーンを”日本(東京)”に設定しましょう

### ステップ11: タスク一覧を作成日時の順番で並び替えましょう

- 現在idの順で並んでいますが、これを作成日時の降順で並び替えてみましょう

- 並び替えがうまく行っていることを feature spec で書いてみましょう

### ステップ12: validationを設定してみよう

- validationを設定しましょう

  - どのカラムにどのvalidationを追加したらよいか考えてみましょう

  - 合わせてDBの制約も設定するmigrationを作成しましょう

  - Migrationファイルだけを作成するため、 rails generate コマンドで作成します

- 画面にvalidationエラーのメッセージを表示するようにしましょう

- Validationに対してモデルのテストを書いてみましょう

- GitHub上でPRを作成してレビューしてもらいましょう

### ステップ13: デプロイをしよう

- masterブランチにシンプルなタスク管理システムができたので、デプロイしてみましょう。

- Herokuにデプロイを実施してみましょう

  - Herokuアカウントは会社用のメールアドレスを使用して新しく作成しましょう

- デプロイされたHeroku上のアプリを触ってみよう

  - これからはこのアプリにタスク（TODO）を登録して開発を進めましょう

  - ※ ただし、Herokuのアプリケーションはインターネットでどこでも参照できるので、公開してはまずい情報は載せないようにしましょう

    - basic認証をこの時点でいれてもいいかもしれません

  - 今後、ステップが終わるたびに、Herokuへ自分のアプリを継続的にデプロイしましょう

- デプロイの方法をRails.root のREADMEに記載しましょう

  - その際に、このアプリで使っているフレームワークのバージョン情報なども記載しておくとなお良いです。

### ステップ14: 終了期限を追加しよう

- タスクに対して、終了期限を登録できるようにしてみましょう

- 一覧画面で、終了期限でソートできるようにしましょう

- spec を拡充しましょう

- PRしてレビューをしてもらったら、リリースしてみましょう

### ステップ15: ステータスを追加して、検索できるようにしよう

- ステータス（未着手・着手中・完了）を追加してみよう

  - 【オプション要件】初学者ではない場合は state 管理をする gem を導入しても構いません

- 一覧画面でタイトルとステータスで検索ができるようにしよう

  - 【オプション要件】初学者ではない場合は ransack などの検索の実装を便利にする gem を導入しても構いません

- 絞り込んだ時にログを見て発行されるSQLの変化を確認してみましょう

  - 以降のステップでも必要に応じて確認する癖をつけましょう

- 検索indexを貼りましょう

- 検索に対して model spec を追加してみよう（feature spec も拡充しておきましょう）

### ステップ16: 優先順位を設定しよう（※類似した実装経験のある人は省略可）

- タスクに対して、優先順位（高中低）を登録できるようにしよう

- 優先順位でソートできるようにしましょう

- feature spec を拡充しましょう

- PRしてレビューをしてもらったら、リリースしてみましょう（以降続けて下さい）

### ステップ17: ページネーションを追加しよう

- Kaminari という gem を使って一覧画面にページネーションを追加してみましょう

### ステップ18: デザインを当てよう

- Bootstrapを導入して、これまで作成したアプリにデザインを当てましょう

  - 【オプション要件】自分でCSSを書いて、デザインをしても良いです

### ステップ19: 複数人で利用できるようにしよう（ユーザの導入）

- ユーザモデルを作成してみましょう

- 最初のユーザを、seedで作成してみましょう

- ユーザとタスクが紐づくようにしましょう

  - 関連に対してindexを貼りましょう

  - N+1問題を回避するための仕組みを取り入れましょう

  - ※ Herokuにデプロイした時に、すでに登録されているタスクとユーザが紐付いているようにしてください（データメンテナンス）

### ステップ20: ログイン/ログアウト機能を実装しよう

- Gemは使わず、自分で実装しましょう

  - Gemを使わないことで、HTTPのCookieやRailsにおけるSessionなどの仕組みについて理解を深めることが目的です

  - また、一般的な認証についての理解を深めることも目的にしています（パスワードの取扱についてなど）

- ログイン画面を実装しましょう

- ログインしていない時は、タスク管理のページに遷移できないようにしましょう

- 自分が作成したタスクだけを表示するようにしましょう

- ログアウト機能を実装しましょう

### ステップ21: ユーザの管理画面を実装しよう

- 画面上に管理メニューを追加しましょう

- 管理画面にはかならず /admin というURLを先頭につけるようにしましょう

  - routes.rb に追加する前に、あらかじめURLやroute名(*_path となる名前) を想定して設計してみましょう

- ユーザ一覧・作成・更新・削除を実装しましょう

- ユーザを削除したら、そのユーザが抱えているタスクを削除するようにしてみましょう

- ユーザの一覧画面で、ユーザが持っているタスクの数を表示するようにしてみましょう

- ユーザが作成したタスクの一覧が見られるようにしてみましょう

### ステップ22: ユーザにロールを追加しよう

- ユーザに管理ユーザと一般ユーザを区別するようにしてみましょう

- 管理ユーザだけがユーザ管理画面にアクセスできるようにしてみましょう

- ユーザ管理画面でロールを選択できるようにしましょう

- 管理ユーザが１人もいなくならないように削除の制御をしましょう

- ※ gemの使用・不使用は自由です

### ステップ23: タスクにラベルを付けられるようにしよう

- タスクに複数のラベルをつけられるようにしてみましょう

- つけたラベルで検索できるようにしてみましょう

### ステップ24: エラーページを適切に設定しましょう

- Railsが用意しているデフォルトのエラーページを自分が作った画面にしてみましょう

- 状況に応じて、適切にエラーページを設定しましょう

  - ステータスコードの 404 ページと 500 ページの２種類の設定は少なくとも必須とします

## あとがき

お疲れ様でした。あなたは教育プログラムを一通り完遂しました!!

このカリキュラムでは触れきれませんでしたが、今後は以下のトピックなどが必要になると思うので、学習を進めていくと良いと思います。（案件を通じて学ぶことも多いと思います）

- Webアプリケーションの基本的な理解を深める

  - HTTPとHTTPSに関する理解

- Railsのもう少し進んだ使い方を習得する

  - STI

  - ロギング

  - 明示的なトランザクション

  - 非同期処理

  - Assets-pipeline（どちらかというとリリース系のトピック）

- JavascriptやCSSなどのフロントエンドに関するより高度な理解

- Databaseに対する理解を深める

  - SQL

  - よりパフォーマンスを重視したクエリの構築

  - インデックスの理解をより深める

- サーバ環境に関するより多くの理解

  - Linux OS

  - Webサーバ (nginx) の設定

  - アプリケーションサーバ ( unicorn ) の設定

  - PostgreSQLに関する設定への理解

- リリースに関するツールの理解

  - Capistrano

  - ansible

## （番外編）オプション要件

必須要件とは別に、タスク管理システムに関するオプション要件を以下に示します。メンターと相談しつつ必要に応じて実施してみて下さい

### オプション要件1:  終了間近や期限の過ぎたタスクがあった場合、アラートを出したい

- ログインした時点で、どこかに終了間近や期限の過ぎたタスクを表示してみましょう

- 既読とかが分かるようになるとより良い

### オプション要件2:  ユーザの間でタスクを共有できるようにしたい

- 複数人で同じタスクを参照・編集できるようにしたい

  - 例：メンターとメンティーでタスクを共有できること

  - ※ 基本ステップに入れても良いかもしれない

- 作成者を表示する

### オプション要件3: グループを設定できるようにしたい

- オプション要件2の続き

- グループを設定できるようにして、グループ内だけでタスクを参照できるようにしたい

### オプション要件4: タスクに添付ファイルをつけられるようにしたい

- タスクに対して添付ファイルをつけられるようにしてみましょう

- Herokuの場合はS3バケットにアップロードした添付ファイルを管理するようにします

- 適切にgemを選別して利用してみましょう

### オプション要件5: ユーザにプロフィール画像を設定できるようにしてみましょう

- ユーザがプロフィール画像を設定できるようにしましょう

- アップロードした画像はアイコンとして使用するので、遅くならないようにサムネイル画像も作りたい

- 適切にgemやライブラリを選別しましょう

### オプション要件6: タスクカレンダーの機能が欲しい

- 終了期限を可視化するために、カレンダーに終了期限別にタスクを表示するようにしてみましょう

- ライブラリの使用・不使用は自由です。

### オプション要件7: タスクをドラッグ・アンド・ドロップで並べ替えられるようにしたい

- タスク一覧でタスクをドラッグ・アンド・ドロップして並べ替えできるようにしてみましょう

### オプション要件8:ラベルの使用頻度をグラフ化してみましょう

- 統計情報を可視化するために、グラフを導入してみましょう

- グラフの種類は見やすいものを提案してみましょう

### オプション要件9: 終了間近のタスクを作成ユーザ宛にメール通知してみましょう

- バックグラウンドで終了間近のタスクがある場合メール通知してみましょう

- メール送信はクラウドサービスを利用します

  - Herokuならば sendgrid

  - AWSならば Amazon SES とか？

- １日１回のバッチで送信するようにしてみましょう

  - Herokuならば cron アドオン

  - AWSだったら cron を設定してみる

### オプション要件10: AWS にインスタンスを作って環境構築する

  

- AWSに環境構築をしてデプロイしてみましょう

- ミドルウェアは万葉の推奨構成になります

  - Nginx + Unicorn で構築してください

  - EC2のインスタンス等はサーバ要件を参照してください

